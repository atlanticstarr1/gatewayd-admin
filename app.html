<!DOCTYPE html>
<html lang="en" ng-app="rippleGatewayApp">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Ripple Gateway Template: Launch your Gateway Today</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- @todo: fill with your company info or remove -->
<meta name="description" content="">
<meta name="author" content="Ripple Labs">

<!-- Bootstrap CSS -->
<link href="theme/css/bootstrap.min.css" rel="stylesheet">

<!-- Font Awesome -->
<link href="theme/css/font-awesome.min.css" rel="stylesheet">

<!-- Plugins -->
<link href="theme/plugins/prism/prism.css" media="screen" rel="stylesheet" />
<link href="theme/plugins/slider-revolution/rs-plugin/css/settings.css?v=4.2" media="screen" rel="stylesheet" />
<link href="theme/plugins/animate/animate.css" rel="stylesheet">
<link href="theme/plugins/flexslider/flexslider.css" rel="stylesheet">
<link href="theme/plugins/clingify/clingify.css" rel="stylesheet">

<!-- Theme style -->
<link href="theme/css/theme-style.min.css" rel="stylesheet">

<!--Your custom colour override-->
<link href="theme/css/colour-blue.css" id="colour-scheme" rel="stylesheet">

<!-- Your custom override -->
<link href="theme/css/custom-style.css" rel="stylesheet">

<!-- HTML5 shiv & respond.js for IE6-8 support of HTML5 elements & media queries -->
<!--[if lt IE 9]>
      <script src="theme/plugins/html5shiv/dist/html5shiv.js"></script>
      <script src="theme/plugins/respond/respond.min.js"></script>
    <![endif]-->

<!-- Le fav and touch icons - @todo: fill with your icons or remove -->
<link rel="shortcut icon" href="theme/img/icons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="theme/img/icons/114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="theme/img/icons/72x72.png">
<link rel="apple-touch-icon-precomposed" href="theme/img/icons/default.png">
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,300|Rambla|Calligraffitti' rel='stylesheet' type='text/css'>

<style>
  .throbber {
    text-align:center;
    -webkit-animation: spin 0.7s infinite linear;
    -moz-animation: spin 0.7s infinite linear;
    -o-animation: spin 0.7s infinite linear;
    -ms-animation: spin 0.7s infinite linear;
  }
  a.active {
    color: #EBEBE8;
    background-color: #353535;
    border-color: transparent;
  }
  tr { opacity: 0.8 }
  tr:hover { 
    opacity: 1.0;
    cursor: pointer;
  }
</style>

<!--Retina.js plugin - @see: http://retinajs.com/-->
<script src="theme/plugins/retina/js/retina-1.1.0.min.js"></script>
</head>

<body class="page page-index" ng-controller="MainCtrl">
<a href="#content" class="sr-only">Skip to content</a>
<div id="navigation" class="wrapper">
  <div class="navbar-static-top"> 
    
    <!--Hidden Header Region-->
    <div class="header-hidden">
      <div class="header-hidden-inner container">
        <div class="row">
          <div class="col-sm-4 col-md-4">
            <h3>About Us</h3>
            <p>Making the web a prettier place one template at a time! We make beautiful, quality, responsive Drupal & web templates!</p>
            <a href="theme/about.htm" class="btn btn-sm btn-primary">Find out more</a> </div>
          <div class="col-sm-4 col-md-4"> 
            <!--@todo: replace with company contact details-->
            <h3>Contact Us</h3>
            <address>
            <p><abbr title="Phone"><i class="fa fa-phone"></i></abbr> 019223 8092344</p>
            <p><abbr title="Email"><i class="fa fa-envelope"></i></abbr> info@themelize.me</p>
            <p><abbr title="Address"><i class="fa fa-home"></i></abbr> Sunshine House, Sunville. SUN12 8LU.</p>
            </address>
          </div>
        </div>
      </div>
    </div>
    
    <!--Header & Branding region-->
    <div class="header">
      <div class="header-inner container">
        <div class="row">
          <div class="col-md-8"> 
            <!--branding/logo--> 
            <a class="navbar-brand" ng-href="/" title="Home">
            <h1><span>Ripple</span>Gateway Framework<span></span></h1>
            </a>
            <div class="slogan">Launch your Ripple Gateway today</div>
          </div>
        </div>
      </div>
    </div>
    
    <!--Change order for full width navbar
  <div class="navbar" style='background-color:#00ADBB'> 
    <div class="container" data-toggle="clingify" style='background-color:#00ADBB'>-->
    <div class="container" data-toggle="clingify" style='background-color:#00ADBB'>
      <div class="navbar" style='background-color:#00ADBB'> 
        <!--
      mobile collapse menu button
      - data-toggle="toggle" = default BS menu
      - data-toggle="jpanel-menu" = jPanel Menu
      --> 
        <a class="navbar-btn" data-toggle="jpanel-menu" data-target=".navbar-collapse"> <span class="bar"></span> <span class="bar"></span> <span class="bar"></span> <span class="bar"></span> </a> 
        
        <!--user menu-->
        <div ng-show='user.isLogged' class="btn-group user-menu pull-right"> <a ng-click="user.logout()" class="btn btn-primary dropdown-toggle login" data-toggle="modal">Logout</a> </div>
        <div ng-show="user.isLogged && !user.isAdmin"><a ng-href="/app#/users" ng-class="{active: path == '/users'}"style='color:#ffffff; float:right;padding-top:18px;padding-right:30px;'>Welcome, {{ user.name }}</a></div>
        <div ng-hide='user.isLogged' class="btn-group user-menu pull-right"> <a ng-href="/app#/login" class="btn btn-primary dropdown-toggle login" data-toggle="modal">Login</a> </div>
        <div ng-hide='user.isLogged' class="btn-group user-menu pull-right"> <a ng-href="/app#/register" class="btn btn-primary dropdown-toggle login" data-toggle="modal">Register</a> </div>
        
        <!--everything within this div is collapsed on mobile-->
        <div class="navbar-collapse collapse"> 
          
          <!--main navigation-->
          <ul class="nav navbar-nav">
            <li class="home-link"><a href="/"><i class="fa fa-home"></i><span class="hidden">Home</span></a></li>
              <!-- Dropdown Menu -->
              <ul class="dropdown-menu" role="menu" aria-labelledby="about-drop">
                <li role="presentation"><a role="menuitem" href="theme/about.htm" tabindex="-1" class="menu-item">About Us</a></li>
                <li role="presentation"><a role="menuitem" href="theme/team.htm" tabindex="-1" class="menu-item">Our Team</a></li>
                <li role="presentation"><a role="menuitem" href="theme/contact.htm" tabindex="-1" class="menu-item">Contact</a></li>
              </ul>
            </li>
            <li ng-show="user.isLogged && !user.isAdmin"><a ng-href="/app#/account" ng-class="{active: path == '/account'}"style='color:#ffffff; float:right;padding-top:18px;padding-right:30px;'>Account</a></li>
            <li ng-show="user.isLogged && !user.isAdmin"><a ng-href="/app#/deposit" ng-class="{active: path == '/deposit'}"style='color:#ffffff; float:right;padding-top:18px;padding-right:30px;'>Deposit</a></li>
            <li ng-show="user.isLogged && !user.isAdmin"><a ng-href="/app#/withdraw" ng-class="{active: path == '/withdraw'}"style='color:#ffffff; float:right;padding-top:18px;padding-right:30px;'>Withdraw</a></li>
            <li ng-show="user.isLogged && user.isAdmin"><a ng-href="/app#/users" ng-class="{active: path == '/users'}"style='color:#ffffff; float:right;padding-top:18px;padding-right:30px;'>Users</a></li>
            <li ng-show="user.isLogged && user.isAdmin"><a ng-href="/app#/deposits" ng-class="{active: location.path() == '/withdrawals'}" style='color:#ffffff; float:right;padding-top:18px;padding-right:30px;'>Deposits</a></li>
            <li ng-show="user.isLogged && user.isAdmin"><a ng-href="/app#/withdrawals" ng-class="{active: location.path() == '/withdrawals'}" style='color:#ffffff; float:right;padding-top:18px;padding-right:30px;'>Withdrawals</a></li>
            <li ng-show="user.isLogged && user.isAdmin"><a ng-href="/app#/payments/outgoing" ng-class="{active: location.path() == '/withdrawals'}" style='color:#ffffff; float:right;padding-top:18px;padding-right:30px;'>Outgoing Payments</a></li>
            <li ng-show="user.isLogged && user.isAdmin"><a ng-href="/app#/payments/incoming" ng-class="{active: location.path() == '/withdrawals'}" style='color:#ffffff; float:right;padding-top:18px;padding-right:30px;'>Incoming Payments</a></li>
          </ul>
        </div>
        <!--/.navbar-collapse --> 
      </div>
    </div>
  </div>
</div>
<div id="highlighted" style='display:none'> 
  <!--
      Showshow - Slider Revolution
      see: plugins/slider-revolution/examples&sources for help
      invoke using data-toggle="slider-rev"
      options can be passed to the slider via HTML5 data- ie. data-startwidth="960"
      -->
  <div class="slider-wrapper tp-banner-container" data-page-class="slider-revolution-full-width-behind slider-appstrap-theme">
    <div class="tp-banner" data-toggle="slider-rev" data-delay="9000" data-startwidth="1100" data-startheight="590" data-fullWidth="off">
      <ul>
        <!-- SLIDE 1 -->
        <li class="slide" data-transition="fade" data-slotamount="5" data-masterspeed="1800"> <img src="theme/img/patterns/white_wall_hash.png" alt="slidebg1"  data-bgfit="normal" data-bgposition="left top" data-bgrepeat="repeat"> 
          
          <!-- SLIDE 1 Content-->
          <div class="slide-content"> 
            <!--elements within .slide-content are pushed below navbar on "behind"-->
            <div class="tp-caption sfb ltl"
                  data-x="10"
                  data-y="50"
                  data-speed="400"
                  data-start="800"
                  data-easing="Back.easeOut"
                  data-endspeed="500"
                  data-endeasing="Back.easeIn"
                  data-captionhidden="on"> <img src="theme/img/slides/slide1.png" alt="Slide 1"  /> </div>
            <h2 class="tp-caption customin randomrotateout"
                  data-x="700"
                  data-y="120"
                  data-speed="400"
                  data-start="1200"
                  data-customin="x:0;y:0;z:0;rotationX:0;rotationY:0;rotationZ:0;scaleX:0;scaleY:0;skewX:0;skewY:0;opacity:0;transformPerspective:600;transformOrigin:50% 50%;"
                  data-easing="Back.easeOut"
                  data-endspeed="400"
                  data-endeasing="Back.easeIn">Start your Ripple Gateway</h2>
            <p class="tp-caption customin randomrotateout"
                  data-x="700"
                  data-y="190"
                  data-speed="400"
                  data-start="1600"
                  data-customin="x:0;y:0;z:0;rotationX:0;rotationY:0;rotationZ:0;scaleX:0;scaleY:0;skewX:0;skewY:0;opacity:0;transformPerspective:600;transformOrigin:50% 50%;"
                  data-easing="Back.easeOut"
                  data-endspeed="400"
                  data-endeasing="Back.easeIn">Deploy a Ripple Gateway in 10 minutes</p>
            <p class="tp-caption customin randomrotateout"
                  data-x="700"
                  data-y="220"
                  data-speed="400"
                  data-start="1600"
                data-customin="x:0;y:0;z:0;rotationX:0;rotationY:0;rotationZ:0;scaleX:0;scaleY:0;skewX:0;skewY:0;opacity:0;transformPerspective:600;transformOrigin:50% 50%;"
                  data-easing="Back.easeOut"
                  data-endspeed="400"
                  data-endeasing="Back.easeIn">Process deposits to and withdrawals from Ripple.</p>
            <p class="tp-caption customin randomrotateout"
                  data-x="700"
                  data-y="250"
                  data-speed="400"
                  data-start="1600"
                  data-customin="x:0;y:0;z:0;rotationX:0;rotationY:0;rotationZ:0;scaleX:0;scaleY:0;skewX:0;skewY:0;opacity:0;transformPerspective:600;transformOrigin:50% 50%;"
                  data-easing="Back.easeOut"
                  data-endspeed="400"
                  data-endeasing="Back.easeIn">REST API for building your currency platform.</p>
            <p class="tp-caption customin randomrotateout"
                  data-x="700"
                  data-y="280"
                  data-speed="400"
                  data-start="1600"
                  data-customin="x:0;y:0;z:0;rotationX:0;rotationY:0;rotationZ:0;scaleX:0;scaleY:0;skewX:0;skewY:0;opacity:0;transformPerspective:600;transformOrigin:50% 50%;"
                  data-easing="Back.easeOut"
                  data-endspeed="400"
                  data-endeasing="Back.easeIn">Customize your Gateway app in a day.</p>
            <a href="#" class="tp-caption customin randomrotateout btn btn-lg btn-primary"
                  data-x="700"
                  data-y="350"
                  data-speed="400"
                  data-start="1800"
                  data-customin="x:0;y:0;z:0;rotationX:0;rotationY:0;rotationZ:0;scaleX:0;scaleY:0;skewX:0;skewY:0;opacity:0;transformPerspective:600;transformOrigin:50% 50%;"
                  data-easing="Back.easeOut"
                  data-endspeed="400"
                  data-endeasing="Back.easeIn">Get Started</a> </div>
        </li>
        <!-- SLIDE 2 -->
        <li data-transition="curtain-1" data-slotamount="4" data-masterspeed="500" > <img src="theme/img/patterns/lightpaperfibers.png"  alt="slidebg1"  data-bgfit="normal" data-bgposition="left top" data-bgrepeat="repeat"> 
          
          <!-- SLIDE 2 Content -->
          <div class="slide-content"> 
            <!--elements within .slide-content are pushed below navbar on "behind"-->
            <div class="tp-caption sfb ltr"
                  data-x="left"
                  data-y="bottom"
                  data-speed="900"
                  data-start="1200"
                  data-easing="Elastic.easeOut"
                  data-endspeed="200"
                  data-endeasing="Power0.easeInOut"> <img src="theme/img/slides/slide2-layer1.png" alt="Slide 2 layer 1" /> </div>
            <div class="tp-caption sfb ltr"
                  data-x="right"
                  data-y="bottom"
                  data-speed="700"
                  data-start="1900"
                  data-easing="Elastic.easeOut"
                  data-endspeed="200"
                  data-endeasing="Power0.easeInOut"> <img src="theme/img/slides/slide2-layer2.png" alt="Slide 2 layer 2" /> </div>
            <div class="tp-caption sfb ltr"
                  data-x="center"
                  data-y="bottom"
                  data-speed="900"
                  data-start="1500"
                  data-easing="Elastic.easeOut"
                  data-endspeed="200"
                  data-endeasing="Power0.easeInOut"> <img src="theme/img/slides/slide2-layer3.png" alt="Slide 2 layer 3" /> </div>
            <h2 class="tp-caption sfb randomrotateout" data-x="center"
                  data-y="30"
                  data-speed="1500"
                  data-start="2300"
                  data-easing="Elastic.easeOut"
                  data-endspeed="200"
                  data-endeasing="Power0.easeInOut">Issue Currencies on Ripple</h2>
            <p class="tp-caption sfb randomrotateout" data-x="center"
                  data-y="60"
                  data-speed="1500"
                  data-start="2300"
                  data-easing="Elastic.easeOut"
                  data-endspeed="200"
                  data-endeasing="Power0.easeInOut">and hold the assets they represent</h2>
          </div>
        </li>
      </ul>
      <div class="tp-bannertimer tp-bottom"></div>
    </div>
    <!--end of tp-banner--> 
  </div>
</div>

<div id="content" ng-view=""></div>

<!-- FOOTER -->
<footer id="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-3 col">
        <div class="block contact-block"> 
          <!--@todo: replace with company contact details-->
          <h3>Contact Us</h3>
          <address>
          <ul class="fa-ul">
            <li><abbr title="Phone"><i class="fa fa-li fa-phone"></i></abbr> 019223 8092344</li>
            <li><abbr title="Email"><i class="fa fa-li fa-envelope"></i></abbr> info@gatewayinabox.com</li>
            <li><abbr title="Address"><i class="fa fa-li fa-home"></i></abbr> Sunshine House, Sunville. SUN12 8LU.</li>
          </ul>
          </address>
        </div>
      </div>
      <div class="col-md-5 col">
        <div class="block">
          <h3>About Us</h3>
          <p>We are a top issuer of the finest digital crypto currency on Ripple you will find.</p>
        </div>
      </div>
      <div class="col-md-4 col">
        <div class="block newsletter">
          <h3>Newsletter</h3>
          <p>Stay up to date with our latest news and product releases by signing up to our newsletter.</p>
          <!--@todo: replace with mailchimp code-->
          <form role="form" id='newsletterForm'>
            <div class="input-group input-group-sm">
              <label class="sr-only" for="email-field">Email</label>
              <input type="text" class="form-control" id="email-field" placeholder="Email">
              <span class="input-group-btn">
              <button class="btn btn-primary" type="button">Go!</button>
              </span> </div>
          </form>
        </div>
      </div>
    </div>
    <div class="row">
      <div id="toplink"><a href="#top" class="top-link" title="Back to top">Back To Top <i class="fa fa-chevron-up"></i></a></div>
      <!--@todo: replace with company copyright details-->
      <div class="subfooter">
        <div class="col-md-6">
          <p>Site template by <a href="theme/appstraptheme.com">Ripple Gateway</a> | Copyright 2012 &copy; Ripple Gateway</p>
        </div>
        <div class="col-md-6">
          <ul class="list-inline footer-menu">
            <li><a href="#">Terms</a></li>
            <li><a href="#">Privacy</a></li>
            <li><a href="#">Contact Us</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

<!--Scripts --> 
<script src="/bower_components/angular/angular.min.js"></script>
<script src="/bower_components/angular-route/angular-route.min.js"></script>
<script src="theme/js/jquery.min.js"></script> 
<script src="theme/js/jquery-migrate-1.2.1.min.js"></script> <!--Legacy jQuery support for quicksand plugin--> 

<!-- Bootstrap JS --> 
<script src="theme/js/bootstrap.min.js"></script> 

<!--JS plugins--> 
<script src="theme/plugins/prism/prism.js"></script> 
<script src="theme/plugins/slider-revolution/rs-plugin/js/jquery.themepunch.plugins.min.js?v=4.2"></script> 
<script src="theme/plugins/slider-revolution/rs-plugin/js/jquery.themepunch.revolution.min.js?v=4.2"></script> 
<script src="theme/plugins/flexslider/jquery.flexslider-min.js"></script> 
<script src="theme/plugins/clingify/jquery.clingify.min.js"></script> 
<script src="theme/plugins/jPanelMenu/jquery.jpanelmenu.min.js"></script> 
<script src="theme/plugins/jRespond/js/jRespond.js"></script> 
<script src="theme/plugins/quicksand/jquery.quicksand.js"></script> 

<!--Custom scripts mainly used to trigger libraries --> 
<script src="theme/js/script.min.js"></script>

<script>

  var rippleGatewayApp = angular.module('rippleGatewayApp', [
    'ngRoute'
  ]);

  rippleGatewayApp.controller('HomeCtrl', ['$scope', function($scope){
    $scope.path = $location.path();
    $scope.location = $location;
    console.log($location.path());
    $scope.isHome = true;
    $('#highlighted').show();
  }]);

  function makeDeposit($scope, $http) {
    console.log(makeDeposit);
    $scope.loading = true;
    $(".throbber").show(); 
    var opts = { 
      name: $scope.deposit.username, 
      amount: $scope.deposit.amount,
      currency: $scope.deposit.currency
    };

    $http.post('/api/v1/deposits', opts)
    .success(function(response, status, headers, config) {
      $scope.loading = false;
      $(".throbber").hide(); 
      $scope.deposit = response.deposit;
    })
    .error(function(data, status, headers, config) {
      $scope.loading = false;
      $(".throbber").hide(); 
    });
  }

  function getUserExternalTransactions(http, userId, fn) {
    http.get('/api/v1/users/'+userId+'/external_transactions')
    .success(function(response, status, headers, config) {
      fn(null, response.externalTransactions);
    })
    .error(function(data, status, headers, config) {
      fn(data, null);
    });
  }

  function getUserRippleTransactions(http, userId, fn) {
    http.get('/api/v1/users/'+userId+'/ripple_transactions')
    .success(function(response, status, headers, config) {
      console.log(response);
      fn(null, response.rippleTransactions);
    })
    .error(function(data, status, headers, config) {
      console.log(data);
      fn(data, null);
    });
  }

  rippleGatewayApp.controller('UserCtrl', ['$scope', '$http','$location', '$routeParams', function($scope, $http, $location, $routeParams){
    var userId = $routeParams.id;
    $scope.loading = true;  
    $scope.externalTransactions = [];
    getUserExternalTransactions($http, userId, function(err, transactions) {
      $scope.loading = false;
      $scope.externalTransactions = transactions;
    });

    getUserRippleTransactions($http, userId, function(err, transactions) {
      $scope.loading = false;
      $scope.rippleTransactions = transactions;
    });
  }]);

  rippleGatewayApp.controller('RegistrationCtrl', ['$scope', 'UserService', '$location', function($scope, $user, $location) {
    $scope.newUser = {
      name: '',
      password: '',
      ripple_address: ''
    }; 
    $scope.register = function() {
      $user.register($scope.newUser, function(err, user){
        if (err) {
          console.log('error registering user:', err);
        } else { 
          console.log('registered a new user:', user);
          $location.path('/app#/users/35');
        }
      });
    };
  }]);

  rippleGatewayApp.controller('LoginCtrl', ['$scope', 'UserService', '$location', function($scope, $user, $location) {

    $scope.login = function() {
      var password = $scope.user.password;
      var name = $scope.user.name;
      $user.login(name, password, function(err, user) {
        
        if (err) {
          console.log('error');
        } else {
          if (user) {
            $user.isLogged = true; 
            $user.password = password;
            if (user.admin) {
              $user.name = 'admin';
              $user.isAdmin = true;
              $location.path('/admin');
            } else {
              $user.name = user.name;
              $user.id = user.id;
              $user.isAdmin = false;
              $location.path('/users/'+user.id);
            }
          }
        } 
      });
    }
  }]);

  rippleGatewayApp.controller('UsersCtrl', ['$scope', '$http','$location', function($scope, $http, $location){
    $scope.navigateToUser = function(id) { 
      $scope.loading = true;
      $location.path('/users/'+id);
    };

    $scope.path = $location.path();
    $scope.makeDeposit = function() {
      makeDeposit($scope, $http);
    };
    $scope.deposit = {};
    $scope.loading = true;
    $scope.isHome = false;
    $('#highlighted').hide();
    $scope.users = [];
    $scope.currencies = [];
    getCurrencies($http, function(err, currencies) {
      $scope.currencies = currencies; 
    });
    $http({ method: 'GET', url: '/api/v1/users' })
    .success(function(response, status, headers, config) {
      $scope.loading = false;
      $(".throbber").hide(); 
      $scope.users = response.users;
    })
    .error(function(data, status, headers, config) {
      $(".throbber").hide(); 
    });
  }]);

  function getCurrencies($http, fn) {
    $http.get('/api/v1/currencies')
    .success(function(resp, status, headers, config) {
      fn(null, resp.currencies);
    })
    .error(function(data, stats, headers, config) {
      fn(data, null);
    });
  }

  rippleGatewayApp.service('UserService', ['$http', '$location', function($http, $location) {
    function registerUser(opts, fn) {
      $http({ method: "POST", url: '/api/v1/register/', data: opts })
      .success(function(response, status, headers, config) {
        fn(null, response.user);
      })
      .error(function(data, status, headers, config) {
        fn(data, null);
      });
    }

    function loginUser(opts, fn) {
      $http({ method: "POST", url: '/api/v1/users/login', data: opts })
      .success(function(response, status, headers, config) {
        fn(null, response.user);
      })
      .error(function(data, status, headers, config) {
        fn(data, null);
      });
    }

    var user = { 
      name: "",
      password: "",
      id: "",
      isLogged: false,
      isAdmin: false,
      login: function(name, password, fn) {
        loginUser({ name: name, password: password }, fn);
      },
      logout: function(fn) {
        user.name = "";
        user.password = "";
        user.id = "";
        user.isLogged = false;
        user.isAdmin = false;
        $location.path("/login");
      },
      register: function(opts, fn){
        registerUser({
          name: opts.name,
          password: opts.password,
          ripple_address: opts.ripple_address
        }, fn);
      }
    };
    return user;
  }]);

  rippleGatewayApp.controller('AccountCtrl', [
    '$scope', 
    '$http', 
    '$location', 
    'UserService', function($scope, $http, $location, $user){
    
    if (!$user.isLogged) {  $location.path('/login') };
    if ($user.isAdmin) {  $location.path('/admin') };

    var userId = $user.id;
    $scope.loading = true;  
    $scope.externalTransactions = [];
    $scope.rippleTransactions = [];
    getUserExternalTransactions($http, userId, function(err, transactions) {
      $scope.loading = false;
      $scope.externalTransactions = transactions;
    });

    getUserRippleTransactions($http, userId, function(err, transactions) {
      $scope.loading = false;
      $scope.rippleTransactions = transactions;
    });

    $scope.withdrawAddress = [];
    function getUserWithdrawalAddress(fn) {
      console.log('getUserWithdrawalAddress');
      $http({ method: 'GET', url: "/api/v1/users/"+$user.id+"/ripple_addresses" })  
      .success(function(response, status, headers, config) {
        var rippleAddresses = response.rippleAddresses;
        if (rippleAddresses) {
          var hostedAddress = null;  
          for (var i=0; i<rippleAddresses.length; i++) {
            var address = rippleAddresses[i];
            console.log(address);
            if (!hostedAddress && address.type == "hosted") {
              hostedAddress = address;
            }
          }
          fn(null, hostedAddress);
        }
        $('.throbber').hide();
      })
      .error(function(data, status, headers, config) {
        fn(data, null);
        console.log('error:', data); 
        $('.throbber').hide();
      });
    };

    getUserWithdrawalAddress(function(err, address){
      console.log(err, address);
      $scope.withdrawAddress = address;
    });

  }]);

  rippleGatewayApp.controller('AdminCtrl', [
    '$scope', 
    '$http', 
    '$location', 
    'UserService', function($scope, $http, $location, $user){


    if (!$user.isAdmin) {  $location.path('/login') };

    $scope.path = function() {$location.path() };
    $scope.makeDeposit = function() {
      makeDeposit($scope, $http);
    };

    $scope.clearWithdrawal = function(id) {
      $('.throbber').show();
      $http({ method: "POST", url: '/api/v1/withdrawals/'+id+'/clear' })
      .success(function(response, status, headers, config) {
        getPendingWithdrawals();
        $('.throbber').hide();
      })
      .error(function(data, status, headers, config) {
        console.log('error:', data); 
        $('.throbber').hide();
      });
    };

    $scope.loading = true;
    $scope.isHome = false;
    $('#highlighted').hide();
    $scope.pendingWithdrawals = [];
    $scope.outgoingPayments = [];
    $scope.queuedDeposits = [];
    $scope.currencies = [];
    getCurrencies($http, function(err, currencies) {
      $scope.currencies = currencies; 
    });

    function getPendingWithdrawals() {
      $http({method: 'GET', url: '/api/v1/withdrawals'})
      .success(function(response, status, headers, config) {
        $scope.loading = false;
        $(".throbber").hide(); 
        $scope.pendingWithdrawals = response.withdrawals;
      })
      .error(function(data, status, headers, config) {
        $(".throbber").hide(); 
      });
    }

    function getOutgoingPayments() {
      $http({method: 'GET', url: '/api/v1/payments/outgoing'})
      .success(function(response, status, headers, config) {
        $scope.loading = false;
        $(".throbber").hide(); 
        $scope.outgoingPayments = response.payments;
      })
      .error(function(data, status, headers, config) {
        $(".throbber").hide(); 
      });
    }

    function getQueuedDeposits() {
      $http({method: 'GET', url: '/api/v1/deposits'})
      .success(function(response, status, headers, config) {
        $scope.loading = false;
        $(".throbber").hide(); 
        $scope.queuedDeposits = response.deposits;
      })
      .error(function(data, status, headers, config) {
        $(".throbber").hide(); 
      });
    }

    function getIncomingPayments() {
      $http({method: 'GET', url: '/api/v1/payments/incoming'})
      .success(function(response, status, headers, config) {
        $scope.loading = false;
        $(".throbber").hide(); 
        $scope.incomingPayments = response.payments;
      })
      .error(function(data, status, headers, config) {
        $(".throbber").hide(); 
      });
    }

    getIncomingPayments();
    getPendingWithdrawals();
    getOutgoingPayments();
    getQueuedDeposits();
  }]);

  rippleGatewayApp.controller('MainCtrl', ['$scope', '$location', 'UserService', function($scope, $location, $user) {
    $scope.$on('$routeChangeStart', function(next, current) { 
      if (!$user.isLogged && $location.path() != '/register') {
        $location.path("/login");
      };
    });

    $scope.user = $user;
  }]);

  rippleGatewayApp.config(['$routeProvider',
    function($routeProvider) {
      $routeProvider.
        when('/admin', {
          controller: 'AdminCtrl',
          templateUrl: 'partials/admin/index.html'
        }).
        when('/account', {
          controller: 'AdminCtrl',
          templateUrl: 'partials/admin.html'
        }).
        when('/login', {
          controller: 'LoginCtrl',
          templateUrl: 'partials/login.html'
        }).
        when('/register', {
          controller: 'RegistrationCtrl',
          templateUrl: 'partials/register.html'
        }).
        when('/deposits', {
          controller: 'AdminCtrl',
          templateUrl: 'partials/admin/deposits.html'
        }).
        when('/payments/outgoing', {
          controller: 'AdminCtrl',
          templateUrl: 'partials/admin/outgoing_payments.html'
        }).
        when('/payments/incoming', {
          controller: 'AdminCtrl',
          templateUrl: 'partials/admin/incoming_payments.html'
        }).
        when('/withdrawals', {
          controller: 'AdminCtrl',
          templateUrl: 'partials/admin/withdrawals.html'
        }).
        when('/users', {
          controller: 'UsersCtrl',
          templateUrl: 'partials/users.html'
        }).
        when('/users/:id', {
          controller: 'UserCtrl',
          templateUrl: 'partials/user.html'
        }).
        when('/account', {
          controller: 'AccountCtrl',
          templateUrl: 'partials/user.html'
        }).
        when('/deposit', {
          controller: 'AccountCtrl',
          templateUrl: 'partials/user/deposit.html'
        }).
        when('/withdraw', {
          controller: 'AccountCtrl',
          templateUrl: 'partials/user/withdraw.html'
        }).
        otherwise({
          redirectTo: '/login'
        });
      }]);

</script>
</body>
</html>
